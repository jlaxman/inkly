#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ§ª Running tests before commit..."

# Check if Docker containers are running
if ! command -v docker-compose &> /dev/null; then
  echo "âš ï¸  docker-compose not found. Skipping tests."
  exit 0
fi

if ! docker-compose ps | grep -q "inkly-backend.*Up"; then
  echo "âš ï¸  Docker containers are not running. Skipping tests."
  echo "   Start containers with: docker-compose up -d"
  exit 0
fi

# Run tests in Docker containers
echo "ğŸ³ Running tests in Docker containers..."

echo "ğŸ“¦ Testing backend..."
docker-compose exec -T backend npm test -- --passWithNoTests || {
  echo "âŒ Backend tests failed!"
  exit 1
}

echo "ğŸ¨ Testing frontend..."
docker-compose exec -T frontend npm test -- --passWithNoTests || {
  echo "âŒ Frontend tests failed!"
  exit 1
}

echo "âœ… All tests passed!"
